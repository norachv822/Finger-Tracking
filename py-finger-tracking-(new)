import cv2 
import mediapipe as mp 
from pythonosc.udp_client import SimpleUDPClient 

client = SimpleUDPClient("127.0.0.1", 9000) #127.0.0.1-->il computer comunica con se stesso, 9000-->porta di connessione 

mp_hands = mp.solutions.hands 
hands = mp_hands.Hands( 
    max_num_hands=1, #cambiando questo parametro si possono tracciare piu' mani
    min_detection_confidence=0.7,  
    min_tracking_confidence=0.7 
)
mp_draw = mp.solutions.drawing_utils #per disegnare i landmarks

cap = cv2.VideoCapture(0) #0 per la webcam di default

while True:
    success, img = cap.read() #legge un frame dalla webcam
    if not success: # se non riesce a leggere il frame,
        break  # esce dal ciclo
    img = cv2.flip(img, 1)  #per avere l'effetto specchio
    rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB) 
    results = hands.process(rgb) 
    if results.multi_hand_landmarks: 
        for handLms in results.multi_hand_landmarks: #NOTA: in questo ciclo for, per disegnare le mappatura della mano, e' necessrio solo 
         indice_tip = handLms.landmark[8]            #      mp_draw.draw_landmarks(img, handLms, mp_hands.HAND_CONNECTIONS) 
         pollice_tip = handLms.landmark[4]
         indice_MCP = handLms.landmark[5]
         pollice_MCP = handLms.landmark[1]

         client.send_message("/indice", [indice_tip.x, indice_tip.y])
         client.send_message("/pollice", [pollice_tip.x, pollice_tip.y])
         client.send_message("/indicemcp", [indice_MCP.x, indice_MCP.y])
         client.send_message("/pollicemcp", [pollice_MCP.x, pollice_MCP.y])

         mp_draw.draw_landmarks(img, handLms, mp_hands.HAND_CONNECTIONS) 
    cv2.imshow("MediaPipe Finger Tracking", img) 
    if cv2.waitKey(1) & 0xFF == 27: 
        break
cap.release() 
cv2.destroyAllWindows() 
